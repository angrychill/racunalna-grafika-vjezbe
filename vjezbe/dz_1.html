<!doctype html>
<html lang="hr">
	<head>
		<meta charset="UTF-8">
		<title>DZ1 - Iris Stare</title>
	</head>

	<body>
		<h1>DZ1 - Iris Stare</h1>	
		<canvas id="canvas1" width="600" height="600" style="border:5px solid black">
			Vaš preglednik ne podržava HTML5 canvas.
		</canvas>

		<script>
			class GKS {
				

				constructor(platno, xmin, xmax, ymin, ymax) {
					this.g = platno.getContext("2d");
					this.w = platno.width;
					this.h = platno.height;
					this.x_min = xmin;
					this.x_max = xmax;
					this.y_min = ymin;
					this.y_max = ymax;

					this.s_x = this.w / (this.x_max -this.x_min);
					this.s_y = -this.h / (this.y_max - this.y_min);
					this.p_x = -this.s_x * this.x_min;
					this.p_y = -this.s_y * this.y_max;
				}

				nacrtajGlavneOsi(koristiOznake = false, razmak = 1) {
					this.g.beginPath();
					this.g.moveTo(0, this.p_y);
					this.g.lineTo(this.w, this.p_y);
					this.g.moveTo(this.p_x, 0);
					this.g.lineTo(this.p_x, this.h);
					this.g.strokeStyle = "black";
					this.g.lineWidth = 2;
					this.g.stroke()

					if (koristiOznake == true){
						this.g.font = "14px Times New Roman";
						var offset = 14;

						for (let x = this.x_min; x<= this.x_max + 1; x += razmak) {
							var koords = this.vratiPretvoreneKoord(x, 0);
							this.g.fillText(x, koords.x, koords.y + offset);
						}

						for (let y = this.y_min; y<= this.y_max + 1; y += razmak) {
							var koords = this.vratiPretvoreneKoord(0, y);
							this.g.fillText(y, koords.x + offset, koords.y);
						}

					}
				}

				postaviNa(x, y) {
					var kords = this.vratiPretvoreneKoord(x,y);
					// beginPath uvijek prije moveTo!
					this.g.beginPath();
					this.g.moveTo(kords.x, kords.y);
				}

				linijaDo(x, y, stroke = false) {
					var kords = this.vratiPretvoreneKoord(x, y);
					this.g.lineTo(kords.x, kords.y);
					this.g.moveTo(kords.x, kords.y);
				
					if (stroke == true){
						this.povuciLiniju();
					}
	
				}
				
				koristiBoju(c) {
					if (typeof c != "string"){
						alert("boja nije string!");
					}
					this.g.strokeStyle = c;

				}

				korisitDebljinu(c){
					if (typeof c != "number"){
						alert("debljina nije broj!");
					}

					this.g.lineWidth = c;
				}

				povuciLiniju() {
					this.g.stroke();
					
				}

				vratiPretvoreneKoord(x, y) {
					var x_i = this.p_x + this.s_x * x;
					var y_i = this.p_y + this.s_y * y;
		
					return {x: x_i, y: y_i };
				}
				
			}

			function nactrajElipsu(gks, a, b, ishodiste = {x: 0, y: 0}, rezolucija = 0.05){
				if (!gks || !(gks instanceof GKS)) alert("Greška - nema platna!");
				if (!a || !b || typeof a != "number" || typeof b != "number") alert("Nema argumenata!");
			
				// x - a*cos(t), y - b*sin(t),
				// t e [0, 2*PI]
				console.log(typeof a);

				gks.postaviNa(ishodiste.x, ishodiste.y);

				for (let t = 0; t<= 2*Math.PI + rezolucija; t = t+rezolucija){
					var x_d = a*Math.cos(t) + ishodiste.x;
					var y_d = b*Math.sin(t) + ishodiste.y;

					if (t == 0){
						gks.postaviNa(x_d, y_d);
					} else {
						gks.linijaDo(x_d, y_d);

					}
	
				}
				gks.povuciLiniju();


			}

			function nacrtajLeptira(gks,rezolucija = 0.05, skaliraj = 1, donja = 0, gornja = Math.PI*12, ishodiste = {x: 0, y: 0}){
				if (!gks || !(gks instanceof GKS)) alert("Greška - nema platna!");
				if (typeof donja != "number" || typeof gornja != "number") alert("Nema argumenata!");
				for (var t = donja; t<=gornja + rezolucija; t = t+rezolucija){
					var R = (Math.exp(Math.cos(t)) - 2 * Math.cos(4 * t) + Math.pow(Math.sin(t / 12), 5));
					var x = R * Math.sin(t) * skaliraj;
					var y = R * Math.cos(t) * skaliraj;
					if (t == 0) {
						gks.postaviNa(x, y);
					} else {
						gks.linijaDo(x, y);
					}
				
				
				}
				
				
				gks.povuciLiniju();


			}

		    window.onload = function() {
				// priprema
				var platno1 = document.getElementById("canvas1");
				if(!platno1) alert("Greška - nema platna!");
				var w = platno1.width;
				var h = platno1.height;
				var g = platno1.getContext("2d");
				
				var x_min = -10;
				var x_max = 10;
				var y_min = -10;
				var y_max = 10;


            var donji_seg = document.getElementById("donji_seg");
            var donji_seg_tekst = document.getElementById("donji_seg_tekst");
            var gornji_seg = document.getElementById("gornji_seg");
            var gornji_seg_tekst = document.getElementById("gornji_seg_tekst");
			
			var leptir_scale = document.getElementById("leptir_scale");
			var leptir_scale_tekst = document.getElementById("leptir_scale_tekst");
			
			var rez = document.getElementById("rez");
            var rez_tekst = document.getElementById("rez_tekst");
			
			donji_seg.value = 0;
			gornji_seg.value = 12*Math.PI;
			leptir_scale.min = 0;
			leptir_scale.max = 2;
			leptir_scale.step = 0.1;
			leptir_scale.value = 1.0;

			rez.min = 0.01;
			rez.max = 1.0;
			rez.step = 0.01;
			rez.value = 0.05;
		

			donji_seg.addEventListener("input", event => {
                donji_seg_tekst.innerHTML = donji_seg.value;
                precrtaj();
            });

			gornji_seg.addEventListener("input", event => {
                gornji_seg_tekst.innerHTML = gornji_seg.value;
                precrtaj();
            });

			leptir_scale.addEventListener("input", event => {
                leptir_scale_tekst.innerHTML = leptir_scale.value;
                precrtaj();
            });

			rez.addEventListener("input", event => {
                rez_tekst.innerHTML = rez.value;
                precrtaj();
            });




				leptir_scale_tekst.innerHTML = leptir_scale;

				var gks = new GKS(platno1, x_min, x_max, y_min, y_max);
				gks.nacrtajGlavneOsi(true);
				//nactrajElipsu(gks, 4, 2, {x: 2, y: 2}, 0.05);
				gks.korisitDebljinu(1);
				gks.koristiBoju("red");
				
				function precrtaj(){
					nacrtajLeptira(gks, rez.value, leptir_scale.value, donji_seg.value, gornji_seg.value);
				}
            }

			
			

		</script>

		<div style="margin-top:150px; margin-bottom:30px;">
        <label for="donji_seg">donji segment</label>
        <input type="range" id="donji_seg" min="0" style="width:300px;"><span id="donji_seg_tekst">0</span><br><br>
        <label for="gornji_seg">gornji segment</label>
        <input type="range" id="gornji_seg" min="13" style="width:300px;"><span id="gornji_seg_tekst">12*PI</span>
        <hr style="width:400px; margin-left:0px; margin-top:30px; margin-bottom:30px; border-color:blue;">
        <label for="leptir_scale">skala leptira</label>
        <input type="range" id="leptir_scale" min="0" style="width:300px;"><span id="leptir_scale_tekst">1</span><br><br>
        <label for="rez">rezolucija</label>
        <input type="range" id="rez" min="0" style="width:300px;"><span id="rez_tekst">0.05</span><br><br>
        
        </div>
	</div>
	</body>
</html>